---
title: "Hypothesis Testing "
author: "Aarushi Verma"
date: '2022-07-13'
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

In this section we focus on the first part of the prompt, which asks us to analyze the motivations for lending among Kiva contributors to developing nation entrepreneurs. Our approach here is suitable for students with limited statistical background: we first explore the general characteristics of borrowers, then we contrast the characteristics of funded borrowers to those of non-funded borrowers, using both descriptive statistics and hypothesis testing. Since lenders choose whom they fund, the results of this analysis will reveal the types of borrowers which lenders prefer, and may suggest motivations for lending.

## Setup

Before we dive into the analysis, we need to import all the required packages. This includes packages for statistical analysis and visualization - many of which you will be familiar with from earlier sections.

### Importing the required packages

The packages we use in this walk through are:

```{r libraries, warning=FALSE, echo=TRUE, message=FALSE}
library("ggplot2")
library("plotly")
library("tidyverse")
library("readr")
library("colorblindr")
library("viridis")
library("memisc")
library("kableExtra")
options(readr.show_col_types = FALSE)
```

### Reading the data

We use the `lender loans` and `loans` files for this analysis. The `lender loans` file contains detailed loans and lender information with corresponding borrowers. The `loans` file has detailed borrower information and their respective loans, however this file does not contain any lender information.

REALLY WOULD BE BETTER TO SHOW HOW TO DO THIS IN R. LET'S GO OVER IT IN MEETING TODAY.

Our prompt relates to motivations for lending to developing-nation entrepreneurs, therefore to focus on the appropriate borrowers we subset our data. While the term "developing nation" is not clearly defined, we use data from world bank to separate the borrowers' countries into low income and high income groups in the `lender loans` file. We perform this step using Microsoft excel and import the updated data set for the rest of our analysis

```{r input_data, echo=TRUE, warning=FALSE, results='asis'}

wdi <- read.csv("data/CLASS.csv", header = TRUE)
kiva_l <- read_csv("data/lender_loans.csv")
kiva_ll<- left_join(kiva_ll, wdi, by = c("location.country" = "Economy")) %>%

  # FIX RENAME HERE

kiva.countries <- unique(kiva_ll$location.country)

kiva_loan <- read_csv(("data/loans.csv"))
```

## Analysis

### Descriptive Statistics

We begin by getting an overview of the characteristics of all would-be borrowers, including their gender, sector, country, and requested loan amount. First we look at how the total amount of loans received varies between high income and low income countries using a bar chart. From this, we observe that countries belonging to lower income group receive the majority of loan funds.

```{r indicator , echo = TRUE, include= TRUE, results ='asis'}
# Loan Amount Calculation
income_group <- kiva_ll %>% group_by(income_indicator) %>%
        summarize(tot_loans = sum(loan_amount)/1000) %>%
  arrange(desc(tot_loans))

#Bar Chart country indicator vs Loan Amount
ggplot(income_group) +
  aes(income_indicator, tot_loans, fill =income_indicator) + 
  geom_bar(stat="identity") +
  xlab("Country Income Indicator") +
  ylab("Total loan amount in USD") +
  scale_fill_OkabeIto(order = c(1,2)) +
  ggtitle("Total loan amount vs Country Income Indicator") +
   theme(legend.position = "none")

```

Keeping our prompt in mind, we subset our data to these low income countries and perform the rest of the analysis on that subset.

```{r}
kiva_ll <- kiva_ll %>% filter(income_indicator=="Low income")
```

Because we are interested in differences between funded and non-funded borrowers, we add an indicator for borrower type (sex of the borrower: male, female, or group borrower) and funding status to our data set.

**Borrower Type**

Our current master file `lender_loans_with_wbi.csv` only contains the total number of borrowers. However, the `loans.csv` file contains a split of the count of female and male borrowers. Using this information we can create a new variable which indicates whether a borrower is an individual male borrower, individual female borrower or part of a group. We use the `mutate` function to create this new column and name it `bor_type`. We update the values based on `if_else` conditions. We apply these conditions on the male borrower and female borrower count column. The conditions we use are:

-   If the value in the m_borrower_count column is equal to 1 and f_borrower_count is equal to 0, we update the value in the `bor_type` column as *Male*

-   If the value in the f_borrower_count column is equal to 1 and m_borrower_count is equal to 0, we update the value in the `bor_type` column as *Female*

-   For any other case, we update the value in the `bor_type` column as *Group*

```{r borrower type variable , echo=TRUE,warning=FALSE,results='hide', warnings = FALSE, message=FALSE}
#Get unique borrower id and total male female borrower count
kiva_loan_sub <- kiva_loan %>% group_by(borrower_image_id) %>% 
  summarize(total_m = sum(borrower_m_count),total_f = sum(borrower_f_count))

#Create new borrower type column based on conditions
kiva_loan_sub <- kiva_loan_sub %>%
  mutate(bor_type = if_else(total_m == 1 & total_f == 0, "Male",
                       if_else(total_m == 0 & total_f == 1, "Female","Group")))
```

After creating the indicator variable, we merge those values to the `lender_loans` data frame and check for NAs. This will help us verify if all the values in our left data frame have found corresponding values or not. For the purpose of this analysis we will drop any NAs in the data since it is not possible to obtain that information elsewhere.

```{r master df creation, echo = TRUE, warning=FALSE, results='hide', message=FALSE}

#Checking if each borrower image id maps to 1 Gender or group
kiva_loan_sub %>% 
  group_by(borrower_image_id) %>% 
  summarize(count=n_distinct(bor_type)) %>% 
  arrange(desc(count))

#Merging sex group to main data
kiva_ll_merged <- left_join(x = kiva_ll, y = kiva_loan_sub, by="borrower_image_id")

```

**Funding Status**

Our data contains a `status` column which indicates the current status of the loan. First we look at the unique values in this column and the number of loans associated with each respectively. Further, we use these values to create an indicator variable for whether a loan has been funded or not.

```{r status unique, echo= TRUE, messgae = FALSE, warning=FALSE}

#Looking at unique values and respective loan count in status column
status <- kiva_ll_merged %>% group_by(status) %>% summarize(count = length(unique(loan_id))) %>% arrange(desc(count))

status %>% kbl(caption = "Value Counts of Status column") %>% 
  kable_classic(bootstrap_options ="striped",full_width = F, html_font = "helvetica",position = "left")
```

<br/>

FIX THIS TABLE: CAPITALIZE FIRST LETTER, USE PROPER TERMS RATHER THAN VARNAMES

The status column contains 7 unique values. We look at the data dictionary and Kiva website to get a better idea of what each term means. Based on that we make the classification of these terms to our 2 classes funded and not-funded:

-   Funded: $\texttt{funded, in_repayment, paid, defaulted, refunded}$

-   Not Funded: $\texttt{expired, fundraising}$

```{r funding indicator,echo= TRUE, message = FALSE, warning = FALSE, include=TRUE}

#creating a vector for values which are associated with funded loans
funded_vec <- c("paid","in_repayment","funded","defaulted", "refunded")

#create indicator variable for Funded or not funded loans
kiva_ll_funding <- kiva_ll_merged %>% mutate(funding_status = if_else(
                       kiva_ll_merged$status %in% funded_vec, "Funded","Not Funded"))
```

Once we have added our new indicator columns, we will use descriptive statistics to visualize these and identify trends,to gain some insight into borrower characteristics

We look at the distribution of the funding status of loans among borrower types for various sectors. <!-- We will visualize this data in a tabular format since our data contains two categorical variables. -->

```{r}

#Creating master df for all plots

bor_chr <- kiva_ll_funding %>% group_by(borrower_image_id,loan_id,income_indicator, location.country,sector,bor_type, funding_status) %>%
  summarize(tot_loans = sum(loan_amount)/100,borr_count = max(borrower_count)) %>% arrange(desc(tot_loans))

bor_chr<- na.omit(bor_chr
                  )
#Bar Chart Funding Status vs Loan Amount by Borrower Type
ggplot(bor_chr) +
  aes(funding_status, tot_loans, fill =bor_type) + 
  geom_bar(stat="identity", position = "dodge") +
  xlab("Funding Status") +
  ylab("Total loan amount in USD (000's)") +
  scale_fill_OkabeIto(order = c(3,1,5)) +
  ggtitle("Total loan amount vs Funding Status by Borrower Type") +
  theme(strip.text.x = element_text(size = 16)) + 
  labs(fill = "Borrower Type")

```

```{r piechart, echo = TRUE, warning = FALSE, message = FALSE, results='asis'}

# Separate Funded and Not funded loans

loan_funded <- bor_chr %>%  filter(funding_status=="Funded")
loan_nonfunded <- bor_chr %>%  filter(funding_status == "Not Funded")

#Compute proportions for funded loans
pie_chart_funded <- loan_funded %>% group_by(sector) %>%
  summarize(loan_count = length(unique(loan_id)))
  
pie_chart_funded <- pie_chart_funded %>% 
  mutate(prop = (loan_count / sum(pie_chart_funded$loan_count))*100)%>% 
  arrange(desc(prop)) 

#Compute proportions for non funded loans
pie_chart_nonfunded <- loan_nonfunded %>% group_by(sector) %>%
  summarize(loan_count = length(unique(loan_id)))
  
pie_chart_nonfunded <- pie_chart_nonfunded %>% 
  mutate(prop = (loan_count / sum(pie_chart_nonfunded$loan_count))*100)%>% 
  arrange(desc(prop)) 

# # Pie Chart from data frame with Appended Sample Sizes
# pie(pie_chart_funded$loan_count, labels = pie_chart_funded$prop, main="Pie Chart of Funded Sectors")

```

WHAT TABLE? I DON'T SEE A TABLE. I DON'T UNDERSTAND WHAT YOUR X-AXIS IS HERE.

This table gives us a snapshot of how the proportions of funded and not funded loans are distributed among sectors. The food sector has the highest proportion of loans that have been funded (26.1%) whereas among not funded loans, the highest proportion is in the Retail sector (24.8%). We can further investigate how this varies with respect to borrower type through a bar chart.

```{r, echo = TRUE, message = FALSE, warning=FALSE, results='asis'}

#Funded by borrower type
funded_sec <- loan_funded %>% group_by(sector, bor_type) %>% 
  summarize(loan_count = length(unique(loan_id)))
funded_sec <- funded_sec %>% mutate(prop = (loan_count / sum(funded_sec$loan_count))*100)


ggplot(funded_sec) +
  aes(sector, prop, fill =bor_type) + 
  geom_bar(stat="identity", position = "dodge") +
  xlab("Sector") +
  ylab("Proportion of no. of loans") +
  scale_fill_OkabeIto(order = c(3,1,5)) +
  ggtitle("Proportion of funded loans vs Sector") +
  theme(strip.text.x = element_text(size = 16)) + 
  coord_flip()+
  labs(fill = "Borrower Type")


# Not Funded by borrower type REMOVE THIS ONE

nonfunded_sec <- loan_nonfunded %>% group_by(sector, bor_type) %>% 
  summarize(loan_count = length(unique(loan_id)))
nonfunded_sec <- nonfunded_sec %>% mutate(prop = (loan_count / sum(nonfunded_sec$loan_count))*100)

ggplot(nonfunded_sec) +
  aes(sector, prop, fill =bor_type) + 
  geom_bar(stat="identity", position = "dodge") +
  xlab("Sector") +
  ylab("Proportion of no. loans") +
  scale_fill_OkabeIto(order = c(3,1,5)) +
  ggtitle("Proportion of not funded loans vs Sector") +
  theme(strip.text.x = element_text(size = 16)) + 
  coord_flip()+
  labs(fill = "Borrower Type")

```

THE ABOVE CHART: REMOVE BORROWER TYPE. LET'S JUST FOCUS ON SECTOR , SO WE WANT TO PLOT PROPORTION OF FUNDED LOANS FOR EACH SECTOR. EX: WHOLESALE FUNDED LOANS = \# FUNDED WHOLESALE LOANS/ #(FUNDED + UNFUNDED WHOLESALE LOANS)

UPDATE: IT MIGHT JUST BE A HEADING ERROR. KEEP THE ONE THAT HAS LOAN AMOUNTS, REMOVE THE OTHER.

From this chart we can observe that women tend to have the highest proportion of funded loans in approximately every sector. For not funded loans individual female borrowers seem to share the lowest proportion. This suggests that lenders are more inclined to fund an individual borrower than male or groups.

We have looked at how the proportion of loans varies, next we look at how the average loan amount varies across sectors, for our indicators. Since the number of borrowers is not evenly distributed across types in our data, looking at the average loan amount helps to make the comparisons more material.

```{r avg loan, echo=TRUE, message=FALSE, warning=FALSE, results='asis'}

loan_funded <- bor_chr %>%  filter(funding_status=="Funded")
loan_nonfunded <- bor_chr %>%  filter(funding_status == "Not Funded")


percap_loan_fun <- loan_funded %>% mutate(amount_per_cap= tot_loans/borr_count)
percap_loan_nonfun <- loan_nonfunded %>% mutate(amount_per_cap= tot_loans/borr_count)


#Funded by borrower type
percap_funded_sec <- percap_loan_fun %>% group_by(sector, bor_type) %>% 
  summarize(avg_loan = sum(amount_per_cap))


ggplot(percap_funded_sec) +
  aes(sector, avg_loan, fill =bor_type) + 
  geom_bar(stat="identity", position = "dodge") +
  xlab("Sector") +
  ylab("Avg loan amount (in USD)") +
  scale_fill_OkabeIto(order = c(3,1,5)) +
  ggtitle("Avg. Loan amount vs Sector for funded loans") +
  theme(strip.text.x = element_text(size = 16)) + 
  coord_flip()+
  labs(fill = "Borrower Type")

# Not Funded by borrower type

percap_nonfunded_sec <- percap_loan_nonfun %>% group_by(sector, bor_type) %>% 
  summarize(avg_loan = sum(amount_per_cap))


ggplot(percap_nonfunded_sec) +
  aes(sector, avg_loan, fill =bor_type) + 
  geom_bar(stat="identity", position = "dodge") +
  xlab("Sector") +
  ylab("Avg loan amount (in USD)") +
  scale_fill_OkabeIto(order = c(3,1,5)) +
  ggtitle("Avg. Loan amount vs Sector for funded loans") +
  theme(strip.text.x = element_text(size = 16)) + 
  coord_flip()+
  labs(fill = "Borrower Type")
```

REALLY? THAT'S NOT WHAT I'M SEEING WHEN I LOOK AT THAT CHART. MEN HAVE A HIGHER LOAN AMOUNTS IN EVERY SECTOR UNLESS I'M READING IT WRONG.

Similar to the proportion chart, we see that for funded loans, female borrowers have a significantly higher average loan amount when compared to other borrowers. Female borrowers have the highest average loan amount in the Retail and Food sector. Male borrowers have a higher average loan amount to females in Manufacturing, Transportation and Construction sectors. For not funded loans, the highest average loan amount is dominated by male borrowers. This reiterated the suggestion that lenders are motivated to lend to female borrowers.

<!-- We also look at how the loan amount varies across countries -->

```{r, include = FALSE}

# # Loan Amount Calculation
# tot_loans_country_fun <- loan_funded %>% group_by(location.country) %>%
#         summarize(tot_loans = sum(tot_loans)/1000) %>% 
#   arrange(desc(tot_loans)) %>% 
#   mutate(country = factor(location.country, location.country))
# 
# tot_loans_country_nonfun <- loan_nonfunded %>% group_by(location.country) %>%
#         summarize(tot_loans = sum(tot_loans)/1000) %>% 
#   arrange(desc(tot_loans)) %>% 
#   mutate(country = factor(location.country, location.country))
# 
# #Filter top 10 countries with highest loan amount
# top_10_tot_loan_fun <- head(tot_loans_country_fun,10)
# top_10_tot_loan_nonfun <- head(tot_loans_country_nonfun,10)
# 
# #Bar Chart country vs Loan Amount
# ggplot(top_10_tot_loan_fun)+
#        geom_bar(aes(country,tot_loans, fill =country), stat="identity")+
#   theme(legend.position = "none",axis.text.x = element_text(angle = 30))+
#     xlab("Country")+
#   ylab("Total loan amount in USD ('000s)")+
#   scale_fill_viridis(
#   discrete = TRUE,
#   option = "D") +
#   ggtitle("Top 10 countries by total funded loan amount")
# 
# #Bar Chart country vs Loan Amount
# ggplot(top_10_tot_loan_nonfun)+
#        geom_bar(aes(country,tot_loans, fill =country), stat="identity")+
#   theme(legend.position = "none",axis.text.x = element_text(angle = 30))+
#     xlab("Country")+
#   ylab("Total loan amount in USD ('000s)")+
#   scale_fill_viridis(
#   discrete = TRUE,
#   option = "D") +
#   ggtitle("Top 10 countries by total not funded loan amount")

```

From the plot above we can see that Uganda recieved the total loan amount

We have looked at the borrower characteristics visually through our graphs and descriptive statistics. We now use Hypothesis Testing to further analyze our data.

### Hypothesis Testing

Hypothesis testing is a statistical inference method used to test an assumption about the data or more specifically the population parameters. To understand our lender motivations we will test several hypotheses.

First, we are interested in understanding how individual loans differ based on the gender of the applicant. The total loan amount is biased by the number of borrowers i.e. the number of female and group borrowers is much larger than the male borrowers, therefore we look at the average loan amount per borrower. To keep the analysis simple we subset our data to only Male and Female borrowers and test our hypothesis using a two-sample t-test. A t-test is a statistical test that compares the means of two samples. By subsetting and calculating the average loan amounts, we are comparing sample means using t-test to check our hypothesis.

Our null and alternative hypothesis are:

DO A ONE-SIDED TEST INSTEAD BECAUSE YOUR HYPOTHESIS IS THAT WOMEN GET HIGHER AVERAGE LOANS, AND MORE OF THE LOANS

$H_{0} :$ $\texttt{The true difference between the average loan amount for Males and average loan amount for Females is equal to 0}$

$H_{1}:$ $\texttt{The true difference between the average loan amount for Males and average loan amount for Females is not equal to 0}$

$H_{0}$ *is known as the null hypothesis and* $H_{1}$ *is know as the alternative hypothesis.*

Before we proceed with the t-test, we need to check some assumptions to ensure we are performing a valid t-test. The assumptions for t-test are:

-   The data values are independent. The amount of the loan borrowed by one borrower does not depend on the loan amount borrowed by another.
-   We assume that number of borrowers in our data represent a random sample from the population of borrowers at Kiva.com
-   The values are continuous. The loan amount is a continuous variable
-   We assume that the data is normally distributed
-   We assume that the variance for men and women is equal

THE SAMPLE MEAN NEEDS TO FOLLOW A NORMAL DISTRIBUTION NOT THE DATA ITSELF, AND THAT IS REASONABLY ASSUMED VIA THE CLT. YOU CAN OMIT THE PLOTS BELOW. SIMILARLY, I THINK YOU CAN JUST HAND WAVE THE OTHER ASSUMPTIONS. NOT A GOOD USE OF SPACE SINCE THIS IS SUPPOSED TO BE A BEGINNER-APPROPRIATE TUTORIAL.

We will also check the normality and variance assumption before proceeding with the test.

```{r filter Male Female, out.width = '50%',echo = TRUE, fig.show='hold', warning = FALSE, message=TRUE}

#Subset data to Male and Female borrowers only
pc_gender <- subset(loan_funded, loan_funded$bor_type %in% c("Male","Female"))
pc_gender <- pc_gender %>% mutate(amount_per_cap= tot_loans/borr_count)

par(mfrow=c(1,1))

#Plot distribution of average loan amount
ggplot(pc_gender, aes(x = amount_per_cap, color = bor_type, fill =bor_type)) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 40) +
  theme(legend.position = "none") +
  guides(color = FALSE) +
  ggtitle("Distribution of avg. loan amount by Gender") +
  xlab("Avg. Loan Amount in USD") +
  ylab("Count")

#Plot distribution of transformed average loan amount variable using log
ggplot(pc_gender, aes(x = log(amount_per_cap), color = bor_type, fill = bor_type)) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 40) +
  labs(fill = "Borrower Type") +
  guides(color = FALSE) +
  ggtitle("Distribution of log avg. loan amount by Gender") +
  xlab("Log of Avg. Loan Amount in USD") +
  ylab("Count")

```

From the histograms we can see that the loan amount is highly right skewed. We transform our loan amount variable using a log transformation and we can observe that the distribution of the transformed variable is more normally distributed. This the case for both Male and Female borrower type.

We check the variance assumption by calculating the standard deviation and variance by using the `sd` and `var` function on the transformed data.

```{r summary statistics,echo=TRUE,results='asis',warning=FALSE,message=FALSE}
sum_stat <- pc_gender %>%
  group_by(bor_type) %>%
  summarize (mean = round(mean(amount_per_cap),2),
             mean_log = round(mean(log(amount_per_cap)),2),
             variance = round(var(amount_per_cap),2),
             variance_log = round(var(log(amount_per_cap)),2),
             std_dev = round(sd(amount_per_cap),2),
             std_dev_log = round(sd(log(amount_per_cap)),2))

sum_stat %>% kbl(caption = "Borrower type summary statistics") %>%
  kable_classic(bootstrap_options ="striped",full_width = F, html_font = "helvetica",position = "left")

```

We can see that the variance values and standard deviation are not equal or similar. However, we do see that they are similar for the transformed variable. Since the variances are very different, our assumption is not satisfied. However we can still test our hypothesis using Welch's T-test with unequal variances.

```{r, include = FALSE}
# var.test(amount_per_cap ~ bor_type, data = pc_gender)$p.value
```

To perform the t-test we first separate our data into the respective groups of female and male borrowers. We use the `t-test` function to perform the t-test and calculate the t-statistic and p-values.

```{r hypothesis test, echo = TRUE, message=FALSE,warning=FALSE}

#Subset df to female borrowers
female <- subset(pc_gender,pc_gender$bor_type == "Female")
#Create df with only loan amount per borrower
female_loan <- female %>% pull(amount_per_cap)

#Subset df to male borrowers
male <- subset(pc_gender,pc_gender$bor_type == "Male")
#Create df with only loan amount per borrower
male_loan <- male %>% pull(amount_per_cap)

#hypothesis test
hyp <- t.test(female_loan,male_loan)
hyp
```

DEFINE P-VALUE/REMINDER

Our p-value is less than the alpha value 0.05. This implies that it is statistically significant. A statistically significant p-value indicates strong evidence against our null hypothesis. Therefore, we reject the null hypothesis that there is no difference in the sample means of average loan amount of male and female borrowers.

Now we look at the proportion of loans in the funded and non funded sector. Here we are interested in how the proportion of loans given to female borrowers differs between the funded and non funded category. We will be using a Z test to test two proportions. A z-test is a hypothesis test in which the z-statistic follows a normal distribution.

Our null and alternative hypothesis are:

DO YOU MEAN DIFFERENCE BETWEEN IN H0? EVEN SO, THE RELEVANT QUESTION IS IF FEMALES ARE MORE LIKELY TO BE FUNDED THAN MALES, SO I WOULD DO:

H0: THE PROPORTION OF FUNDED LOANS FOR FEMALES IS EQUAL TO THE PROPORTION OF FUNDED LOANS FOR MALES

SO YOU WOULD WANT TO LOOK AT \# FUNDED FEMALES/ (# FUNDED + UNFUNDED FEMALES) VERSUS \# FUNDED MALES/ (# FUNDED + UNFUNDED MALES)

$H_{0} :$ $\texttt{The true proportion of funded loans and not funded loans for female borrowers is equal to 0}$

$H_{1}:$ $\texttt{The true difference between the proportion of funded loans and not funded loans for female borrowers is not equal to 0}$

To test our proportions we must define an event as a 'success'. In this case, if the borrower type for a loan is female, it is considered a success. We calculate the proportion among funded and not funded loans and test out hypothesis using the `prop.test` function

```{r}

#calculate total unique loans in data
total_funded_loans <- length(unique(loan_funded$loan_id))
total_not_funded_loans <- length(unique(loan_nonfunded$loan_id))

#filter female loans
funded_loans_female <- loan_funded  %>% filter(bor_type=="Female")
nonfunded_loans_female <- loan_nonfunded  %>% filter(bor_type=="Female")

#get count of unique loan ids in female loans
female_funded_count <- length(unique(funded_loans_female$loan_id))
female_nonfunded_count <- length(unique(nonfunded_loans_female$loan_id))

#Test for proportions
prop.test(x = c(female_funded_count,female_nonfunded_count) , n = c(total_funded_loans,total_not_funded_loans), alternative = "two.sided", conf.level = 0.95)

```

Our test returns a p-value of less than 2.2e-16 which is less than the alpha value 0.05. This implies that it is statistically significant. A statistically significant p-value indicates strong evidence against our null hypothesis. Therefore, we reject the null hypothesis that there is no difference in the proportion of funded and not funded loans for female borrowers. Based on this hypothesis test, we can conclude that lender's may be more motivated to lend to female borrowers in low income countries when compared to male borrowers. This is also reflected in our descriptive statistics.

Lastly, we are interested in how the proportion of funded and not funded loans differ across sectors. For the purpose of this hypothesis test we will use the sector which has the highest number of loans - Food. We will use the same approach as the previous hypothesis test as we are comparing proportions. Our null and alternative hypothesis are:

AGAIN, THIS SEEMS LIKE THE WRONG HYPOTHESIS, WE'RE INTERESTED IN THE PROBABILITY OF BEING FUNDED IN FOOD VERSUS AGRICULTURE (OR SOMETHING LIKE THAT). I'M NOT SEEING A CHART WHICH COMMUNICATES THIS CLEARLY, SO THAT WILL NEED TO BE CHANGED.

AFTER YOU DO YOUR BAR CHART OF PROPORTION FUNDED BY SECTOR, PICK THE SECTOR WITH THE HIGHEST FUNDING RATE AND COMPARE TO THE SECTOR WITH THE LOWEST FUNDING RATE.

H0: FUNDING RATE IN AG \[OR WHATEVER MOST LIKELY FUNDED SECTOR IS\] = FUNDING RATE IN RETAIL \[OR LOWEST FUNDED SECTOR\].

FUNDING RATE = \# FUNDED IN SECTOR/ \# FUNDED + UNFUNDED IN SECTOR

h1: AG \> RETAIL

$H_{0} :$ $\texttt{The true difference in proportion of funded loans and not funded loans in the Food sector is equal to 0}$

$H_{1}:$ $\texttt{The true difference in proportion of funded loans and not funded loans in the Food sector is not equal to 0}$

```{r}

#Subset for Food Sector
total_loan_food <- bor_chr %>%  filter(sector == "Food")
total_loan_food_count <- length(unique(total_loan_food$loan_id))

#calculate total funded loans in Food Sector
food_funded_loans <- total_loan_food %>% filter(funding_status=="Funded")
food_funded_loan_count <- length(unique(food_funded_loans$loan_id))


#calculate total not funded loans in Food Sector
food_nonfunded_loans <- total_loan_food %>% filter(funding_status=="Not Funded")
food_nonfunded_loan_count <- length(unique(food_nonfunded_loans$loan_id))

#Test for proportions
prop.test(x = c(food_funded_loan_count,food_nonfunded_loan_count) , n = c(total_loan_food_count,total_loan_food_count), alternative = "two.sided", conf.level = 0.95)

```

BETTER NOT TO USE SCIENTIFIC NOTATION, JUST SAY P\<\< 0.001 OR SOMETHING

Our test returns a p-value of less than 2.2e-16 which is less than the alpha value 0.05. This implies that it is statistically significant. A statistically significant p-value indicates strong evidence against our null hypothesis. Therefore, we reject the null hypothesis that there is no difference in the proportion of funded and not funded loans for Food Sector Based on this hypothesis test, we can conclude that lender's may be more motivated to lend to the Food sector. They could be motivated by things related to the food sector, such as providing nutrition to people in developing nations or in supporting small-scale food businesses.

## Limitations and Conclusion

Our analysis has a few potential limitations. We have made a few assumptions when creating our indicator variables borrower type and funding status. It is possible that these assumptions may have filtered out some data that could have provided us with some more insight. Another limitation is the size of the observations for Not funded loans. There are very few Not Funded loans when compared to Funded Loans and this hinders any comparison we would like to make. We need to assume that our data does not contain the entire population of Not Funded loans.

To conclude, through descriptive statistics we observed that Food and Retail sectors have the highest number of funded loans. We see that female borrowers recieved the highest over all loan amounts throughout 2005-2012. (However, we must keep in mind that our data contains more female borrowers). We also looked at borrower types across sectors and noted that proportion of female borrowers is higher across most sectors among funded loans. We also looked at the average amount given to borrowers across sectors and noted that group borrowers tend to received the lowest average loan amount in funded loans. Through our hypothesis test we learned that the average loan amount received by a borrower does differ based on the borrower's gender. Further we also observed that proportion of loans for female borrowers differs between funded and not funded sectors.

Overall, we can conclude that Lender's may be heterogeneous in their preferences and motivations when it comes to lending. We have aggregated our data at numerous levels which could have led to the Simpson's paradox. This mainly refers to the appearance of a trend in several groups, however it may disappear when the groups are aggregated.

*Note: Performing a paired t-test and proptest respectively is one way of testing our hypothesis, however there are multiple other methods that can be explored to test this hypothesis and further analyze this data.*
